<div class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-4">Шахматка — {{ venue.name }}</h1>
  <div id="timeslots" class="grid grid-cols-1 gap-4">
    <!-- JS вставит карточки timeslot'ов -->
  </div>
</div>

<script>
async function loadSlots(){
  const res = await fetch('/api/timeslots/?venue_id={{venue.id}}');
  const slots = await res.json();
  const container = document.getElementById('timeslots');
  container.innerHTML = '';
  slots.forEach(s => {
    container.innerHTML += `
      <div class="p-4 border rounded">
        <div class="flex justify-between">
          <div>
            <div class="font-semibold">${new Date(s.start).toLocaleString()} — ${new Date(s.end).toLocaleTimeString()}</div>
            <div class="text-sm text-gray-600">${s.description || ''}</div>
          </div>
          <div class="text-right">
            <div class="text-xl">${s.free_places} / ${s.capacity}</div>
            <button class="mt-2 px-3 py-1 bg-blue-500 text-white rounded" onclick="openCreate(${s.id})">Записать</button>
          </div>
        </div>
      </div>`;
  });
}
loadSlots();
async function openCreate(slotId){
  // откроем простую форму создания резерва через fetch POST
  const name = prompt('Имя');
  const phone = prompt('Телефон');
  const people = prompt('Кол-во', '2');
  if(!phone) return;
  const payload = { venue: {{venue.id}}, timeslot: slotId, name, phone, people, requested_time: new Date().toISOString(), idempotency_key: `ui-${Date.now()}`};
  await fetch('/api/reservations/', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
  alert('Создано');
  loadSlots();
}
</script>
